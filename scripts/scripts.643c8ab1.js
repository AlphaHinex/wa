"use strict";AV.initialize("ncucSqWquNS5qSBCNrqEhA8O","d6cARxGcTwgyi0IGz7ss7LHp");var Case=AV.Object.extend("Case"),app=angular.module("wa",["ngRoute","ngMaterial","md.data.table"]),allDefendants=function(){var a="人保财险, 平安保险, 天安保险, 中华联合, 人寿财险, 浙商保险, 华泰保险, 民安保险, 永安保险, 大地保险, 永诚保险, 都邦保险, 信达保险, 华安保险, 太平保险, 太平洋保险, 安华农业, 紫金财险, 渤海保险, 中银保险";return a.split(/, +/g).map(function(a){return a})},createFilterFor=function(a){return function(b){return 0===b.indexOf(a)}},resetCase=function(a,b){a.searchText="",b["case"]={initDate:new Date}},allStates=function(){return["判决","调解","和解","不予受理"]},refreshList=function(a){a.querying=!0,a.allCases=[];var b=a.nameFilter?"where plaintiff like '%"+a.nameFilter+"%' ":"",c="select * from Case "+b+"order by updatedAt desc limit 20";AV.Query.doCloudQuery(c,{success:function(b){var c=b.results;angular.forEach(c,function(b){a.allCases.push({id:b.id,createdAt:b.createdAt,updatedAt:b.updatedAt,initDate:b.attributes.initDate,finishDate:b.attributes.finishDate,plaintiff:b.attributes.plaintiff,defendants:b.attributes.defendants,details:b.attributes.details,state:b.attributes.state})}),a.querying=!1},error:function(b){a.querying=!1,console.dir(b)}})},postSaveAndUpdate=function(a,b,c){resetCase(a,b),refreshList(a),c.show(c.simple().content("保存成功!").position("right top").hideDelay(1500))},saveOrUpdateCallbacks=function(a,b,c,d){return{success:function(e){a.debug("Save case with objectId: "+e.id),postSaveAndUpdate(b,c,d)},error:function(b,c){a.debug("Save case failed cause: "+c.message)}}},saveOrUpdate=function(a,b,c,d){if(c["case"].defendants||(c["case"].defendants=b.searchText),a.debug(c["case"]),c["case"].id){var e=new AV.Query(Case);e.get(c["case"].id,{success:function(e){e.set("initDate",c["case"].initDate),e.set("finishDate",c["case"].finishDate),e.set("plaintiff",c["case"].plaintiff),e.set("defendants",c["case"].defendants),e.set("details",c["case"].details),e.set("state",c["case"].state),e.save(null,saveOrUpdateCallbacks(a,b,c,d))},error:function(b,c){a.debug("Update case failed cause: "+c.message)}})}else{var f=Case["new"](c["case"]);f.save(null,saveOrUpdateCallbacks(a,b,c,d))}},setColor=function(a){var b=allStates(),c="font-weight: bold; color: ";switch(a){case b[0]:c+="red";break;case b[1]:c+="purple";break;case b[2]:c+="green";break;case b[3]:c+="blue"}return c},appCtrl=function(a,b,c){var d=this;d.states=allStates(),d.allDefendants=allDefendants(),resetCase(d,a),refreshList(d),d.querySearch=function(a){return a?d.allDefendants.filter(createFilterFor(a)):d.allDefendants},a.save=function(){saveOrUpdate(c,d,a,b)},a.cancel=function(){resetCase(d,a),refreshList(d)},d.selectCase=function(b){a["case"]=b,d.searchText=a["case"].defendants},a.searchByName=function(){refreshList(d)},d.setColor=setColor};appCtrl.$inject=["$scope","$mdToast","$log"],app.controller("appCtrl",appCtrl);