<div ng-controller="caseCtrl as ctrl">
  <md-toolbar layout="row" class="md-toolbar-tools md-whiteframe-z1">
    <h1 flex>{{ title }}</h1>
    <img src="https://travis-ci.org/AlphaHinex/wa.svg?branch=master" />
    <md-button class="md-warn" ng-click="logout()">登出</md-button>
  </md-toolbar>
  <div layout="row" flex>
    <div layout="column" flex>
      <md-content class="md-padding">
        <md-tabs md-dynamic-height>
          <md-tab id="case">
            <md-tab-label>Case</md-tab-label>
            <md-tab-body>
              <md-card>
                <md-card-content layout-padding>
                  <span class="md-title">案件信息</span>
                  <form name="caseForm">
                    <div layout layout-sm>
                      <label style="align-self: center;">立案日期</label>
                      <md-datepicker ng-model="case.initDate"se.inlaceholder="立案日期"></md-datepicker>
                      <label style="align-self: center; padding-left: 20px;">结案日期</label>
                      <md-datepicker ng-model="case.finishDate" md-placeholder="结案日期"></md-datepicker>
                    </div>
                    <div layout layout-sm="column">
                      <md-input-container flex="40">
                        <label>原告</label>
                        <input ng-model="case.plaintiff" required>
                      </md-input-container>
                      <md-autocomplete
                        flex="60"
                        md-floating-label="被告"
                        md-search-text="ctrl.searchText"
                        md-items="item in ctrl.querySearch(ctrl.searchText)"
                        md-item-text="item"
                        md-min-length="0"
                        md-selected-item="case.defendants">
                        <md-item-template>
                          <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item}}</span>
                        </md-item-template>
                        <md-not-found>
                          "{{ctrl.searchText}}" 尚不存在,请添加.
                        </md-not-found>
                      </md-autocomplete>
                    </div>
                    <md-input-container layout flex>
                      <label>详细记录</label>
                      <textarea ng-model="case.details" columns="1" md-maxlength="1500"></textarea>
                    </md-input-container>
                    <md-input-container>
                      <label>状态</label>
                      <md-select ng-model="case.state">
                        <md-option ng-repeat="state in ctrl.states" value="{{state}}"><span style="{{ctrl.setColor(state)}}">{{state}}</span></md-option>
                      </md-select>
                    </md-input-container>
                    <div class="md-actions" layout="row">
                      <md-button class="md-raised md-primary" ng-click="save()" ng-show="roleName && caseForm.$valid" ng-disabled="ctrl.submiting">保存</md-button>
                      <md-button class="md-raised" ng-click="cancel()">取消</md-button>
                    </div>
                  </form>
                </md-card-content>
              </md-card>
              <md-card>
                <md-card-content>
                  <md-progress-linear md-mode="query" ng-show="ctrl.querying"></md-progress-linear>
                  <span class="md-title">案件列表</span>
                  <md-list>
                    <md-list-item>
                      <md-button class="md-raised md-primary" ng-click="searchByName()">检索</md-button>
                      <md-input-container flex md-no-float>
                        <input ng-model="ctrl.nameFilter" placeholder="按原告姓名模糊搜索">
                      </md-input-container>
                    </md-list-item>
                    <md-list-item class="md-3-line" ng-repeat="item in ctrl.allCases" ng-click="ctrl.selectCase(item)">
                      <div class="md-list-item-text" layout="column">
                        <h3>{{ item.plaintiff }} / {{ item.defendants }}</h3>
                        <h4>
                          <span style="{{ctrl.setColor(item.state)}}">{{ item.state }}</span>
                          ( {{ item.initDate | date:'yyyy-MM-dd' }} ~ {{ item.finishDate | date:'yyyy-MM-dd' }} )
                        </h4>
                        <p>{{ item.details }}</p>
                      </div>
                    </md-list-item>
                  </md-list>
                </md-card-content>
              </md-card>
            </md-tab-body>
          </md-tab>
          <md-tab id="statistic">
            <md-tab-label>Statistic</md-tab-label>
            <md-tab-body>
              <md-card layout-padding>
                <span class="md-title">案件统计</span>
                <div ng-controller="statisCtrl as sCtrl">
                  <div layout="column">
                    <div layout="row">
                      <md-button class="md-raised md-primary" ng-click="sCtrl.query()">检索</md-button>
                      <md-button class="md-raised" ng-click="sCtrl.reset()">清空</md-button>
                    </div>
                    <div layout="row">
                      <label style="align-self: center;">起始日期</label>
                      <md-datepicker ng-model="sc.fromDate" md-placeholder="起始日期"></md-datepicker>
                      <label style="align-self: center; padding-left: 20px;">结束日期</label>
                      <md-datepicker ng-model="sc.toDate" md-placeholder="结束日期"></md-datepicker>
                    </div>
                    <div layout="row">
                      <md-input-container>
                        <label>状态</label>
                        <md-select ng-model="sc.state">
                          <md-option ng-repeat="state in ctrl.states" value="{{state}}"><span style="{{ctrl.setColor(state)}}">{{state}}</span></md-option>
                        </md-select>
                      </md-input-container>
                      <md-autocomplete
                        flex
                        md-floating-label="被告"
                        md-search-text="sc.searchText"
                        md-items="item in ctrl.querySearch(sc.searchText)"
                        md-item-text="item"
                        md-min-length="0"
                        md-selected-item="sc.defendants">
                        <md-item-template>
                          <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item}}</span>
                        </md-item-template>
                        <md-not-found>
                          "{{ctrl.searchText}}" 尚不存在,请添加.
                        </md-not-found>
                      </md-autocomplete>
                    </div>
                  </div>
                  <div class="cvph"></div>
                  <div
                    ui-grid="gridOptions"
                    ui-grid-exporter
                    ui-grid-move-columns
                    ui-grid-pagination
                    ui-grid-pinning
                    ui-grid-resize-columns
                    class="grid">
                  </div>
                </div>
              </md-card>
            </md-tab-body>
          </md-tab>
        </md-tabs>
      </md-content>
    </div>
  </div>
</div>
